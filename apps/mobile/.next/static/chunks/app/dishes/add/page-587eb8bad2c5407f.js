(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[650],{1108:function(t,e,i){Promise.resolve().then(i.bind(i,4772))},9534:function(t,e,i){"use strict";i.d(e,{Z:function(){return h}});var s,a,o=i(5211);(s=a||(a={})).Json="application/json",s.FormData="multipart/form-data",s.UrlEncoded="application/x-www-form-urlencoded",s.Text="text/plain";class n{mergeRequestParams(t,e){let i=t.method||e&&e.method;return{...this.instance.defaults,...t,...e||{},headers:{...i&&this.instance.defaults.headers[i.toLowerCase()]||{},...t.headers||{},...e&&e.headers||{}}}}stringifyFormItem(t){return"object"==typeof t&&null!==t?JSON.stringify(t):"".concat(t)}createFormData(t){return t instanceof FormData?t:Object.keys(t||{}).reduce((e,i)=>{let s=t[i];for(let t of s instanceof Array?s:[s]){let s=t instanceof Blob||t instanceof File;e.append(i,s?t:this.stringifyFormItem(t))}return e},new FormData)}constructor({securityWorker:t,secure:e,format:i,...s}={}){this.securityData=null,this.setSecurityData=t=>{this.securityData=t},this.request=async t=>{let{secure:e,path:i,type:s,query:a,format:o,body:n,...r}=t,l=("boolean"==typeof e?e:this.secure)&&this.securityWorker&&await this.securityWorker(this.securityData)||{},u=this.mergeRequestParams(r,l),h=o||this.format||void 0;return"multipart/form-data"===s&&n&&null!==n&&"object"==typeof n&&(n=this.createFormData(n)),"text/plain"===s&&n&&null!==n&&"string"!=typeof n&&(n=JSON.stringify(n)),this.instance.request({...u,headers:{...u.headers||{},...s?{"Content-Type":s}:{}},params:a,responseType:h,data:n,url:i})},this.instance=o.Z.create({...s,baseURL:s.baseURL||""}),this.secure=e,this.format=i,this.securityWorker=t}}class r extends n{constructor(...t){var e;super(...t),e=this,this.home=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.request({path:"/",method:"GET",...t})},this.anon={authLogin:function(t){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.request({path:"/anon/login",method:"POST",body:t,type:"application/json",format:"json",...i})},authRegister:function(t){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.request({path:"/anon/register",method:"POST",body:t,type:"application/json",format:"json",...i})}},this.api={authGetUserInfo:function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.request({path:"/api/getuserinfo",method:"GET",secure:!0,format:"json",...t})},apiCategoryImportCategory:function(t){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.request({path:"/api/category/import",method:"POST",body:t,secure:!0,type:"multipart/form-data",format:"json",...i})},apiCategoryGetCategory:function(t){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.request({path:"/api/category",method:"GET",query:t,secure:!0,format:"json",...i})},apiCategoryDeleteCategory:function(t){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.request({path:"/api/category/delete",method:"DELETE",query:t,secure:!0,format:"json",...i})},apiDishesSaveDishes:function(t){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.request({path:"/api/dishes/save",method:"POST",body:t,secure:!0,type:"application/json",format:"json",...i})},apiDishesFindPage:function(t){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.request({path:"/api/dishes/findpage",method:"POST",body:t,secure:!0,type:"application/json",format:"json",...i})},apiDishesGetRandomDishes:function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.request({path:"/api/dishes/random",method:"GET",secure:!0,format:"json",...t})},apiFileUploadFile:function(t){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.request({path:"/api/file/uploadimage",method:"POST",body:t,secure:!0,type:"multipart/form-data",format:"json",...i})},apiFileGetImage:function(t){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.request({path:"/api/file/getimage",method:"GET",query:t,format:"json",...i})}}}}var l=i(724);let u=new r({timeout:1e5});u.instance.interceptors.request.use(function(t){return t.headers.Authorization=localStorage.getItem("token"),t},function(t){return Promise.reject(t)}),u.instance.interceptors.response.use(function(t){return"success"!==t.data.code?(l.FN.show({content:t.data.msg||"请求失败",icon:"fail"}),Promise.reject(t)):t.data},function(t){return 401===t.status&&window.location.replace("/login"),Promise.reject(t)});var h=u},4772:function(t,e,i){"use strict";i.r(e),i.d(e,{default:function(){return E}});var s,a,o,n,r,l,u=i(9075),h=i(724),c=i(4359),d=i(511),p=i(5734),m=i(4527),v=i(9407),f=i(4064),y=i(2635),_=i(5220),g=i(8342),b=i(414),w=i(8782),x=(s=new WeakMap,a=new WeakMap,o=new WeakMap,n=new WeakMap,r=new WeakSet,l=new WeakSet,class extends b.l{bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(t){var e;let i=this.options;this.options=(0,p._)(this,s).defaultMutationOptions(t),(0,w.VS)(this.options,i)||(0,p._)(this,s).getMutationCache().notify({type:"observerOptionsUpdated",mutation:(0,p._)(this,o),observer:this}),(null==i?void 0:i.mutationKey)&&this.options.mutationKey&&(0,w.Ym)(i.mutationKey)!==(0,w.Ym)(this.options.mutationKey)?this.reset():(null===(e=(0,p._)(this,o))||void 0===e?void 0:e.state.status)==="pending"&&(0,p._)(this,o).setOptions(this.options)}onUnsubscribe(){if(!this.hasListeners()){var t;null===(t=(0,p._)(this,o))||void 0===t||t.removeObserver(this)}}onMutationUpdate(t){(0,f._)(this,r,j).call(this),(0,f._)(this,l,C).call(this,t)}getCurrentResult(){return(0,p._)(this,a)}reset(){var t;null===(t=(0,p._)(this,o))||void 0===t||t.removeObserver(this),(0,v._)(this,o,void 0),(0,f._)(this,r,j).call(this),(0,f._)(this,l,C).call(this)}mutate(t,e){var i;return(0,v._)(this,n,e),null===(i=(0,p._)(this,o))||void 0===i||i.removeObserver(this),(0,v._)(this,o,(0,p._)(this,s).getMutationCache().build((0,p._)(this,s),this.options)),(0,p._)(this,o).addObserver(this),(0,p._)(this,o).execute(t)}constructor(t,e){super(),(0,y._)(this,r),(0,y._)(this,l),(0,m._)(this,s,{writable:!0,value:void 0}),(0,m._)(this,a,{writable:!0,value:void 0}),(0,m._)(this,o,{writable:!0,value:void 0}),(0,m._)(this,n,{writable:!0,value:void 0}),(0,v._)(this,a,void 0),(0,v._)(this,s,t),this.setOptions(e),this.bindMethods(),(0,f._)(this,r,j).call(this)}});function j(){var t,e;let i=null!==(e=null===(t=(0,p._)(this,o))||void 0===t?void 0:t.state)&&void 0!==e?e:(0,_.R)();(0,v._)(this,a,{...i,isPending:"pending"===i.status,isSuccess:"success"===i.status,isError:"error"===i.status,isIdle:"idle"===i.status,mutate:this.mutate,reset:this.reset})}function C(t){g.V.batch(()=>{if((0,p._)(this,n)&&this.hasListeners()){var e,i,s,o,r,l,u,h;let c=(0,p._)(this,a).variables,d=(0,p._)(this,a).context;(null==t?void 0:t.type)==="success"?(null===(e=(i=(0,p._)(this,n)).onSuccess)||void 0===e||e.call(i,t.data,c,d),null===(s=(o=(0,p._)(this,n)).onSettled)||void 0===s||s.call(o,t.data,null,c,d)):(null==t?void 0:t.type)==="error"&&(null===(r=(l=(0,p._)(this,n)).onError)||void 0===r||r.call(l,t.error,c,d),null===(u=(h=(0,p._)(this,n)).onSettled)||void 0===u||u.call(h,void 0,t.error,c,d))}this.listeners.forEach(t=>{t((0,p._)(this,a))})})}var S=i(3195),k=i(1202);function F(t,e){let i=(0,S.NL)(e),[s]=d.useState(()=>new x(i,t));d.useEffect(()=>{s.setOptions(t)},[s,t]);let a=d.useSyncExternalStore(d.useCallback(t=>s.subscribe(g.V.batchCalls(t)),[s]),()=>s.getCurrentResult(),()=>s.getCurrentResult()),o=d.useCallback((t,e)=>{s.mutate(t,e).catch(k.Z)},[s]);if(a.error&&(0,k.L)(s.options.throwOnError,[a.error]))throw a.error;return{...a,mutate:o,mutateAsync:a.mutate}}var O=i(9534),P=i(5095);function E(){let[t]=h.l0.useForm(),e=(0,P.useRouter)(),{data:i}=(0,c.a)({queryKey:["dishesCategoryList"],queryFn:()=>O.Z.api.apiCategoryGetCategory(),select:t=>t.data.map(t=>({label:t.name,value:t.id}))}),s=F({mutationFn:async t=>(console.log(t),(await O.Z.api.apiFileUploadFile({file:t})).data)}),a=F({mutationFn:async()=>{let{categoryId:i,images:s,...a}=await t.validateFields();await O.Z.api.apiDishesSaveDishes({...a,category_id:null==i?void 0:i[0].toString(),view_id:null==s?void 0:s[0].id.toString()}),h.FN.show({content:"添加成功!",afterClose:()=>e.back()})}});return(0,u.jsxs)("div",{className:"h-full dishes-page px-5 py-5 relative",children:[(0,u.jsxs)(h.l0,{form:t,style:{"--border-bottom":"unset"},layout:"horizontal",children:[(0,u.jsx)(h.l0.Item,{name:"name",label:"菜谱名称",layout:"horizontal",childElementPosition:"right",children:(0,u.jsx)(h.II,{placeholder:"请输入菜谱名称"})}),(0,u.jsx)(h.l0.Item,{name:"categoryId",childElementPosition:"right",label:"分类",trigger:"onConfirm",onClick:(t,e)=>{var i;null===(i=e.current)||void 0===i||i.open()},children:(0,u.jsx)(h.cW,{columns:[i],children:t=>{var e;return t.length?null===(e=t[0])||void 0===e?void 0:e.label:"请选择"}})}),(0,u.jsx)(h.l0.Item,{name:"images",label:"图片",children:(0,u.jsx)(h.wA,{upload:async t=>await s.mutateAsync(t),maxCount:1})}),(0,u.jsx)(h.l0.Item,{name:"desc",label:"菜谱描述",children:(0,u.jsx)(h.II,{placeholder:"请输入菜谱描述"})})]}),(0,u.jsx)("div",{className:"mt-5 absolute w-full px-5 left-0 bottom-6",children:(0,u.jsx)(h.zx,{color:"primary",block:!0,onClick:()=>a.mutate(),children:"保存"})})]})}},5220:function(t,e,i){"use strict";i.d(e,{R:function(){return f},m:function(){return v}});var s,a,o,n,r=i(5734),l=i(4527),u=i(9407),h=i(4064),c=i(2635),d=i(8342),p=i(9752),m=i(707),v=(s=new WeakMap,a=new WeakMap,o=new WeakMap,n=new WeakSet,class extends p.F{setOptions(t){this.options=t,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(t){(0,r._)(this,s).includes(t)||((0,r._)(this,s).push(t),this.clearGcTimeout(),(0,r._)(this,a).notify({type:"observerAdded",mutation:this,observer:t}))}removeObserver(t){(0,u._)(this,s,(0,r._)(this,s).filter(e=>e!==t)),this.scheduleGc(),(0,r._)(this,a).notify({type:"observerRemoved",mutation:this,observer:t})}optionalRemove(){(0,r._)(this,s).length||("pending"===this.state.status?this.scheduleGc():(0,r._)(this,a).remove(this))}continue(){var t,e;return null!==(e=null===(t=(0,r._)(this,o))||void 0===t?void 0:t.continue())&&void 0!==e?e:this.execute(this.state.variables)}async execute(t){var e,i,s,l,c,d,p,v,f,_,g,b,w,x,j,C,S,k,F,O,P;(0,u._)(this,o,(0,m.Mz)({fn:()=>this.options.mutationFn?this.options.mutationFn(t):Promise.reject(Error("No mutationFn found")),onFail:(t,e)=>{(0,h._)(this,n,y).call(this,{type:"failed",failureCount:t,error:e})},onPause:()=>{(0,h._)(this,n,y).call(this,{type:"pause"})},onContinue:()=>{(0,h._)(this,n,y).call(this,{type:"continue"})},retry:null!==(e=this.options.retry)&&void 0!==e?e:0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>(0,r._)(this,a).canRun(this)}));let E="pending"===this.state.status,q=!(0,r._)(this,o).canStart();try{if(!E){(0,h._)(this,n,y).call(this,{type:"pending",variables:t,isPaused:q}),await (null===(_=(g=(0,r._)(this,a).config).onMutate)||void 0===_?void 0:_.call(g,t,this));let e=await (null===(b=(w=this.options).onMutate)||void 0===b?void 0:b.call(w,t));e!==this.state.context&&(0,h._)(this,n,y).call(this,{type:"pending",context:e,variables:t,isPaused:q})}let e=await (0,r._)(this,o).start();return await (null===(i=(s=(0,r._)(this,a).config).onSuccess)||void 0===i?void 0:i.call(s,e,t,this.state.context,this)),await (null===(l=(c=this.options).onSuccess)||void 0===l?void 0:l.call(c,e,t,this.state.context)),await (null===(d=(p=(0,r._)(this,a).config).onSettled)||void 0===d?void 0:d.call(p,e,null,this.state.variables,this.state.context,this)),await (null===(v=(f=this.options).onSettled)||void 0===v?void 0:v.call(f,e,null,t,this.state.context)),(0,h._)(this,n,y).call(this,{type:"success",data:e}),e}catch(e){try{throw await (null===(x=(j=(0,r._)(this,a).config).onError)||void 0===x?void 0:x.call(j,e,t,this.state.context,this)),await (null===(C=(S=this.options).onError)||void 0===C?void 0:C.call(S,e,t,this.state.context)),await (null===(k=(F=(0,r._)(this,a).config).onSettled)||void 0===k?void 0:k.call(F,void 0,e,this.state.variables,this.state.context,this)),await (null===(O=(P=this.options).onSettled)||void 0===O?void 0:O.call(P,void 0,e,t,this.state.context)),e}finally{(0,h._)(this,n,y).call(this,{type:"error",error:e})}}finally{(0,r._)(this,a).runNext(this)}}constructor(t){super(),(0,c._)(this,n),(0,l._)(this,s,{writable:!0,value:void 0}),(0,l._)(this,a,{writable:!0,value:void 0}),(0,l._)(this,o,{writable:!0,value:void 0}),this.mutationId=t.mutationId,(0,u._)(this,a,t.mutationCache),(0,u._)(this,s,[]),this.state=t.state||f(),this.setOptions(t.options),this.scheduleGc()}});function f(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}function y(t){this.state=(e=>{switch(t.type){case"failed":return{...e,failureCount:t.failureCount,failureReason:t.error};case"pause":return{...e,isPaused:!0};case"continue":return{...e,isPaused:!1};case"pending":return{...e,context:t.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:t.isPaused,status:"pending",variables:t.variables,submittedAt:Date.now()};case"success":return{...e,data:t.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...e,data:void 0,error:t.error,failureCount:e.failureCount+1,failureReason:t.error,isPaused:!1,status:"error"}}})(this.state),d.V.batch(()=>{(0,r._)(this,s).forEach(e=>{e.onMutationUpdate(t)}),(0,r._)(this,a).notify({mutation:this,type:"updated",action:t})})}}},function(t){t.O(0,[724,211,349,73,852,999,744],function(){return t(t.s=1108)}),_N_E=t.O()}]);